# operating system_7th
>进程调度
>优先级调度
>多级反馈队列
>死锁
>死锁的预防与解决

## 进程调度
控制进程进入cpu时机的算法
### 时间片轮转机制
### 优先级
+ 静态优先级
	+ 在进程创建时就分配固定的优先级，运行中不改变
	+ `依据：`
		+ 作业、进程类型（系统进程优先级较高）
		+ 对资源的需求（对CPU和内存需求较少的进程，优先级较高）
		+ 用户要求（紧迫程度和付费多少）
                 
+ 动态优先级
	+ 在进程创建时分配优先级，然后在运行过程中根据情况而改变优先级
#### SRR算法
>![image.png](https://i.loli.net/2019/10/29/KgRBJL1mrz4nOyM.png)
#### 优先级调度
cpu分配方式为抢占方式，当高优先级的进程就绪时会抢占正在运行的低优先级的进程的cpu
***
### 多级反馈队列
+ （多级）根据就绪进程优先级的不同，分成多个优先级的就绪子队列，在高优先级的就绪队列为空之后，再调度低优先级队列里的进程
+ 执行完一个时间片的进程会转为就绪状态，并入队第一个优先级的就绪队列
+ （反馈）当从低优先级队列中调入cpu的进程正在运行时，突然有高优先级的进程就绪，就会抢占cpu，低优先级的进程会进入就绪状态并入队原优先级的就绪队列。
+ 如果正在运行的进程阻塞，则会进入阻塞队列，当因为进程调度唤醒时就会进入原优先级的就绪队列。
+ `优点`：
	+ 为提高系统吞吐量和缩短平均周转时间而照顾短进程
	+ 为获得较好的I/O设备利用率和缩短响应时间而照顾I/O型进程；
	+ 不必估计进程的执行时间，动态调节；
+ 

### 死锁
>死锁的定义：
>    一组进程中，每个进程都无限等待被该组进程中另一进程所占有的资源，并在得到资源之前，绝不释放自己所占有的资源，因而永远无法继续执行，这种现象称为进程死锁，这一组进程就称为死锁进程。

+ 发生的必要因素：
	+ 1.`资源独占` 
	+ 2.不可剥夺（物理属性决定）
	+ 3.有多个进程`已经得到部分资源，同时还在申请资源`
	+ 4.`循环等待`
+ 实质：
	+ 进程无限等待已经阻塞了的进程得到的资源的空闲

+ 后果：
	+ 降低系统的效率甚至导致系统死机

### 死锁的预防和解决
+ 不让死锁发生
	+ 静态方案：在进程创建时就分配固定的设备，运()行途中不再分配设备
		+ 弊端：降低了利用率，现已不用
	 + 动态方案：系统在分配设备前预测是否会导致死锁，如果会导致死锁则不进行分配
+ 不管死锁会不会发生
	+ 当死锁发生时，解决死锁
#### 静态方案：
+ 一次性申请所要求的所有资源
+ 破坏“不可剥夺条件”
+ 采用资源有序分配方案，如果不是按照顺序来则不分配
#### 动态预测方案
设计进程需要设备向量：MAX[N]
设计进程已得设备向量：ALLOCT[M][N]（表示m进程得到的n个设备）
设计进程需要设备向量：NEED[M][N] (表示m进程还需要的n个设备)
设计空闲设备向量：WORK[M][N]（表示m设备还空闲的数量为n）
+ 设计对应的算法：
	+ 某一时刻对所有进程的需求进行考量
	+ 得到安全分配算法和不安全分配顺序
	+ 如果是不安全分配顺序则不进行分配，因为不安全算法即使现在不死锁，在运行的未来也会死锁
	+ 如果是安全分配顺序则进行分配
+ 考量的方法：
	+ 根据需求和已有的空闲设备确定下一个可以得到设备运行的进程
	+ 在该进程得到设备运行完后则放设备得到新的空闲进程向量
	+ 根据新的空闲设备向量来确定下一个得到设备的进程
	+ 因为同时可能会有多个进程可以得到设备运行，因此可以得到不同的设备分配顺序
	+ 如果下一个提出请求的进程符合这个顺序，则可以分配设备，如果不符合这个顺序则不分配设备。
#### 死锁的检测与恢复
允许死锁发生，在检测到死锁发生后`采取专门的措施，解除死锁并以最小的代价恢复操作系统运行`
+ 检测时机：
	+ `系统资源利用率降低时检测死锁`
+ `具体实现思路：`
	+ 保存资源使用信息，![image.png](https://i.loli.net/2019/10/29/iBOwUGLCrbHux7z.png)
+ 实现算法：资源分配图
	+ `用有向图描述进程的死锁`
	+ 因为死锁的检测与恢复的思路是检测循环等待，因此资源分配图可以明显地看出回路并检测出来。
+ 算法实现方式：
	+ `系统由若干类资源构成，一类资源称为一个资源类；每个资源类中包含若干个同种资源，称为资源实例。`
	+ 以用户和资源为结点，请求关系为边
		+ 当用户申请时，资源指向用户
		+ 当用户得到后，用户指向资源
		+ 资源实例以资源方框中的黑点表示，，用户以园框表示
		+ ![image.png](https://i.loli.net/2019/10/29/vtim1GRP8aY4Ud7.png)
+ 实现步骤：
	+ `资源分配图中存在环路即死锁，不存在环路即不死锁`
	
